# huntington-tree-finder

## setup

1. clone repository

```shell
git clone git@github.com:nicolasmatthewlee/huntington-tree-finder.git
```

2. build docker image

```shell
# in huntington-tree-finder/
docker build -t huntington-tree-finder .
```

3. start docker container

```shell
# in huntington-tree-finder/
docker run -v .:/home/client --publish 3000:3000 -it huntington-tree-finder sh
```

4. (in container) navigate into repository and install packages

```shell
# in /home/client/
npm i
```

5. (optional) (in container) run the client

```shell
# in /home/client/
npm start
```

6. (in container) build the client

```shell
# in /home/client/
npm run build
```

## deployment with Microsoft Server Manager

1. move the contents of the build folder into `huntington-tree-finder/` in the following directory: `C:\inetpub\wwwroot`
2. run Microsoft Server Manager as administrator (`server manager > right click > more > run as administrator`)
3. open IIS (`tools > Internet Information Services (IIS) Manager`)
4. navigate to `Sites/Default Web Site` and the copied folder should appear within this site
5. navigate to the build folder in file explorer, and modify security properties by adding access for `IIS AppPool\DefaultAppPool` and adding access for `IUSR`

## updating tree list

1. open [ArcGIS Online Assistant](https://ago-assistant.esri.com/)
2. select "I want to..." > "View an Item's JSON" and then select the tree-finder web app
3. update `definitionExpression` with the appropriate accession numbers

```json
"definitionExpression": "PlantCondition <> 'Dead' AND PlantCondition <> 'Removed' AND PlantCondition <> 'Unable to Locate' AND PlantCondition <> 'Indistinguishable' AND PlantCondition <> 'Questionable' AND PublicView = 'Yes' AND PlantHabit = 'Tree' AND AccessionNumber in ('30470','224','397','1542','2544','2943','13535','2005','23688','1764','3357')",
```

_example `definitionExpression`_

4. open the client, and copy the `definitionExpression` string into `filterCriteria`
5. rebuild and redeploy

## file structure

### `README.md`

The `README.md` file is a Markdown file used to provide information about the project.

### `package.json`

The `package.json` file is a metadata file for the project that contains various information such as project dependencies, scripts, version, author, and license. It is used by npm (Node Package Manager) to manage the project's dependencies and scripts.

### `tailwind.config.js`

The `tailwind.config.js` file is a configuration file for Tailwind CSS, a CSS framework.

### `node_modules`

The `node_modules` directory is created by npm and contains all the dependencies of the project. When you install dependencies using `npm install`, npm downloads and installs the required packages into this directory. It is recommended not to modify the contents of this directory manually.

### `public`

The `public` directory is where static assets such as HTML, images, fonts, and other files are placed. The contents of this directory are served as-is by the web server. The `index.html` file, which serves as the entry point of the application, is located in this directory. To change the icon of the application modify the assets located here.

### `tsconfig.json`

The `tsconfig.json` file is a configuration file for TypeScript, a superset of JavaScript that adds static type-checking capabilities. It defines compiler options and settings for the TypeScript compiler.

### `package-lock.json`

The `package-lock.json` file is automatically generated by npm to lock down the version of each installed package and its dependencies. It ensures that subsequent installations of dependencies use the exact same versions to maintain consistency across different environments.

### `src`

The `src` directory contains the source code of the project, including JavaScript/TypeScript files, stylesheets, components, and other assets. The `index.ts` file serves as the main entry point of the application and is located in this directory.

## app structure

### Libraries Used

The project utilizes several JavaScript libraries, including:

- **React**: A popular JavaScript library for building user interfaces.
- **ArcGIS API for JavaScript**: A powerful mapping and spatial analytics platform provided by Esri.

### Component Overview

The `App` component is divided into several sections:

### Import Statements

The import statements at the beginning of the file import necessary modules and components from external libraries. Notable imports include components from the ArcGIS API for JavaScript, such as `WebMap`, `MapView`, `Print`, `Locate`, `Search`, `FeatureLayer`, and various symbols and utilities.

### Component Declaration and Initialization

The `App` component is declared as a functional component using the arrow function syntax provided by React. Inside the component, two `useRef` hooks are initialized to create references to the map view (`mapViewRef`) and graphics layer (`graphicsLayerRef`).

### useEffect Hook

The `useEffect` hook is used to perform side effects in the component, such as initializing the map and adding widgets. The hook ensures that these operations are only executed once when the component is mounted.

### Map Initialization

The `useEffect` hook contains code to initialize the map and its associated view. It creates a new `WebMap` instance using a portal item ID and initializes a `MapView` with the created map instance. The map view is then configured and added to the DOM container with the ID `"mapDiv"`.

### Widgets

The component adds several widgets to the map view, including:

- **Print Widget**: Allows users to print the map.
- **Locate Widget**: Provides functionality to locate the user's current position on the map.
- **Search Widget**: Enables users to search for specific features on the map, such as tree species.

### Graphics Layer

A graphics layer is added to the map view to display markers for search results. This layer is initialized as a `GraphicsLayer` instance and added to the map.

### Search Functionality

The component implements search functionality by creating a custom search source for the feature layer. The `createSearchSource` function generates a search source based on specified search fields and criteria. This source is then used to configure the `Search` widget, allowing users to search for tree species by scientific name, common name, or genus.

### UI Rendering

The `return` statement renders the user interface of the component. It consists of a header section displaying the project name and logo, followed by the map container.
